(function() {
  ({
    "version": 3,
    "names": [],
    "mappings": "",
    "sources": ["recurrence_admin.coffee"],
    "sourcesContent": ["#---------------------------------------------------------------------------\n# Recurrence Widget\n#---------------------------------------------------------------------------\n\nclass RecurrenceWidget\n    constructor: (widgetId) ->\n        ourDiv = $(\"#" + widgetId + "\")\n        @our = ourDiv.find.bind(ourDiv)\n        @_init()\n        return\n\n    _init: () ->\n        showAdvanced = @_hasAdvanced()\n        @our(\".ev-show-advanced-cbx\").prop(\"checked\", showAdvanced)\n        @our(\".ev-advanced-repeat\").toggle(showAdvanced)\n        freq = @our(\".ev-freq-choice > select\").val()\n        @_freqChanged(freq)\n\n    _hasAdvanced: () ->\n        interval = @our(\".ev-interval-num > input\").val()\n        if interval and parseInt(interval) > 1\n            return true\n        weekdaysTicked = @our(\".ev-weekdays :checkbox:checked\").map ->\n            return this.value\n        .get()\n        if weekdaysTicked.length > 1\n            return true\n        dtstart = new Date(@our(\".ev-start-date > input\").val())\n        weekday = (dtstart.getDay() + 6) % 7  # convert from Sun=0 to Mon=0\n        if weekdaysTicked.length == 1 and parseInt(weekdaysTicked[0]) != weekday\n            return true\n        ordChoice = @our(\".ev-ord-choice > select\").val()\n        if parseInt(ordChoice) != 101\n            return true\n        dayChoice = @our(\".ev-day-choice > select\").val()\n        if parseInt(dayChoice) != 200\n            return true\n        return false\n\n    _clearAdvanced: () ->\n        @our(\".ev-interval-num > input\").val(1)\n        @our(\".ev-weekdays :checkbox\").prop(\"checked\", false)\n        dtstart = new Date(@our(\".ev-start-date > input\").val())\n        weekday = (dtstart.getDay() + 6) % 7  # convert from Sun=0 to Mon=0\n        @our(\".ev-weekdays :checkbox[value=" + weekday + "]\").prop(\"checked\", true)\n        @our(\".ev-ord-choice > select\").val(101)\n        @our(\".ev-day-choice > select\").val(200)\n        @our(\".ev-month-choice > select\").val(dtstart.getMonth() + 1)\n        return\n\n    enable: () ->\n        @_enableShowAdvanced()\n        @_enableStartDateChange()\n        @_enableFreqChange()\n        return\n\n    _enableShowAdvanced: () ->\n        @our(\".ev-show-advanced-cbx\").click (ev) =>\n            if $(ev.target).prop(\"checked\")\n                @our(\".ev-advanced-repeat\").show()\n            else\n                @our(\".ev-advanced-repeat\").hide()\n                @_clearAdvanced()\n            return true\n        return\n\n    _enableStartDateChange: () ->\n        @our(\".ev-start-date > input, .ev-\").change (ev) =>\n            showAdvanced = @our(\".ev-show-advanced-cbx\").prop(\"checked\")\n            if not showAdvanced\n                @_clearAdvanced()\n            return false\n        return\n\n    _enableFreqChange: () ->\n        @our(\".ev-freq-choice > select\").change (ev) =>\n            @_freqChanged($(ev.target).val())\n            @_clearAdvanced()\n            return false\n        return\n\n    _freqChanged: (freq) ->\n        vis = [false, false, false]\n        units = \"\"\n        switch parseInt(freq)\n            when 3\n                vis = [false, false, false]\n                units = \"Day(s)\"\n            when 2\n                vis = [true,  false, false]\n                units = \"Week(s)\"\n            when 1\n                vis = [false, true,  false]\n                units = \"Month(s)\"\n            when 0\n                vis = [false, true, true]\n                units = \"Year(s)\"\n        @our(\".ev-advanced-weekly-repeat\").toggle(vis[0])\n        @our(\".ev-advanced-monthly-repeat\").toggle(vis[1])\n        @our(\".ev-advanced-yearly-repeat\").toggle(vis[2])\n        @our(\".ev-interval-units\").text(units)\n        return\n\n@initRecurrenceWidget = (id) ->\n    widget = new RecurrenceWidget(id)\n    widget.enable()\n    return\n\n@initExceptionDateChooser = (id, validDates) ->\n    dtpOpts =\n        onGenerate: (ct) ->\n            future = new Date()\n            future.setDate(future.getDate()+157)\n            future.setDate(1)\n            console.log(future)\n            if validDates != -1 and ct < future\n                $(this).find('td.xdsoft_date').addClass('xdsoft_disabled')\n                for yyyymmdd in validDates\n                    yyyy = parseInt(yyyymmdd[0...4])\n                    mm   = parseInt(yyyymmdd[4...6]) - 1\n                    dd   = parseInt(yyyymmdd[6...8])\n                    $(this).find(\"td.xdsoft_date[data-year=" + yyyy + "][data-month=" + mm + "][data-date=" + dd + "]\")\n                           .removeClass('xdsoft_disabled')\n        closeOnDateSelect: true\n        timepicker:        false\n        scrollInput:       false\n        format:            'Y-m-d'\n        dayOfWeekStart:    0    # Keep this the same as Recurrence\n#        weekends: ['2015/11/05']\n#        disabledDates: ['2015/11/04', '2015/11/03']\n    if window.dateTimePickerTranslations\n        dtpOpts['i18n'] = lang: window.dateTimePickerTranslations\n        dtpOpts['lang'] = 'lang'\n    $('#' + id).datetimepicker(dtpOpts)\n"],
    "file": "recurrence_admin.coffee",
    "sourceRoot": "/source/"
  });

}).call(this);
